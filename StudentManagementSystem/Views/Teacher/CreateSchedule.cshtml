@model StudentManagementSystem.ViewModels.CreateScheduleViewModel
@{
    ViewData["Title"] = "T·∫°o l·ªãch thi m·ªõi";
}

@section Styles {
    <link href="~/css/teacher-ui.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet" />
}

<div class="teacher-page-container">
    <!-- Welcome Header -->
    <div class="welcome-header mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <div class="position-relative z-index-2">
                <h2 class="mb-2 fw-bold">
                    <i class="fas fa-calendar-plus me-2"></i>
                    T·∫°o l·ªãch thi m·ªõi üìÖ
                </h2>
                <p class="mb-0 opacity-75">L√™n l·ªãch thi cho b√†i ki·ªÉm tra</p>
            </div>
            <div class="text-end position-relative z-index-2">
                <a href="@Url.Action("Schedules")" class="btn btn-light btn-lg px-4 py-2 rounded-pill shadow-sm">
                    <i class="fas fa-arrow-left me-2"></i> Quay l·∫°i danh s√°ch
                </a>
            </div>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-0 pb-0">
                    <h5 class="mb-0 text-success fw-bold">
                        <i class="fas fa-calendar-plus me-2"></i> Th√¥ng tin l·ªãch thi
                    </h5>
                </div>
            <div class="card-body">
                <form asp-action="CreateSchedule" method="post">
                    <div asp-validation-summary="All" class="text-danger mb-3"></div>
                    
                    <div class="mb-3">
                        <label asp-for="ExamId" class="form-label"></label>
                        <select asp-for="ExamId" class="form-select">
                            <option value="">-- Ch·ªçn b√†i ki·ªÉm tra --</option>
                            @foreach (var exam in ViewBag.Exams as IEnumerable<StudentManagementSystem.Models.Exam>)
                            {
                                <option value="@exam.Id">@exam.Title</option>
                            }
                        </select>
                        <span asp-validation-for="ExamId" class="text-danger"></span>
                    </div>
                    
                    <div class="mb-3">
                        <label asp-for="ClassId" class="form-label"></label>
                        <select asp-for="ClassId" class="form-select">
                            <option value="">-- Ch·ªçn l·ªõp h·ªçc --</option>
                            @foreach (var classItem in ViewBag.Classes as IEnumerable<StudentManagementSystem.Models.Class>)
                            {
                                <option value="@classItem.Id">
                                    @classItem.ClassName - @classItem.Semester/@classItem.Year
                                    (@classItem.ClassStudents.Count sinh vi√™n)
                                </option>
                            }
                        </select>
                        <span asp-validation-for="ClassId" class="text-danger"></span>
                        <div class="form-text">
                            <i class="fas fa-info-circle"></i>
                            Ch·ªçn l·ªõp h·ªçc m√† b·∫°n ƒëang gi·∫£ng d·∫°y
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label asp-for="StartTime" class="form-label"></label>
                                <input asp-for="StartTime" class="form-control" type="datetime-local" />
                                <span asp-validation-for="StartTime" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label asp-for="EndTime" class="form-label"></label>
                                <input asp-for="EndTime" class="form-control" type="datetime-local" />
                                <span asp-validation-for="EndTime" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Th·ªùi l∆∞·ª£ng thi</label>
                        <div class="input-group">
                            <input type="number" id="duration" class="form-control" readonly />
                            <span class="input-group-text">ph√∫t</span>
                        </div>
                        <div class="form-text">
                            <i class="fas fa-info-circle"></i>
                            Th·ªùi l∆∞·ª£ng ƒë∆∞·ª£c t√≠nh t·ª± ƒë·ªông d·ª±a tr√™n th·ªùi gian b·∫Øt ƒë·∫ßu v√† k·∫øt th√∫c
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label asp-for="Location" class="form-label"></label>
                        <input asp-for="Location" class="form-control" placeholder="VD: Ph√≤ng A101, H·ªôi tr∆∞·ªùng, Online..." />
                        <span asp-validation-for="Location" class="text-danger"></span>
                    </div>
                    
                    <div class="mb-3">
                        <label asp-for="Instructions" class="form-label"></label>
                        <textarea asp-for="Instructions" class="form-control" rows="4" placeholder="H∆∞·ªõng d·∫´n cho h·ªçc sinh: c√°ch th·ª©c l√†m b√†i, quy ƒë·ªãnh, l∆∞u √Ω..."></textarea>
                        <span asp-validation-for="Instructions" class="text-danger"></span>
                    </div>
                    
                    <div class="alert alert-info">
                        <h6><i class="fas fa-lightbulb"></i> L∆∞u √Ω quan tr·ªçng:</h6>
                        <ul class="mb-0">
                            <li><strong>Th·ªùi gian:</strong> ƒê·∫£m b·∫£o th·ªùi gian b·∫Øt ƒë·∫ßu v√† k·∫øt th√∫c h·ª£p l√Ω</li>
                            <li><strong>L·ªõp h·ªçc:</strong> Ch·ªâ h·ªçc sinh thu·ªôc l·ªõp n√†y m·ªõi th·∫•y ƒë∆∞·ª£c l·ªãch thi</li>
                            <li><strong>ƒê·ªãa ƒëi·ªÉm:</strong> Ghi r√µ ƒë·ªãa ƒëi·ªÉm ƒë·ªÉ h·ªçc sinh kh√¥ng b·ªã nh·∫ßm l·∫´n</li>
                            <li><strong>H∆∞·ªõng d·∫´n:</strong> Cung c·∫•p th√¥ng tin chi ti·∫øt v·ªÅ c√°ch th·ª©c l√†m b√†i</li>
                        </ul>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="@Url.Action("Schedules")" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Quay l·∫°i
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> T·∫°o l·ªãch thi
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Quick Templates -->
<div class="row justify-content-center mt-4">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-magic"></i> M·∫´u nhanh</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <button type="button" class="btn btn-outline-primary w-100 mb-2" onclick="setQuickTemplate('midterm')">
                            <i class="fas fa-clock"></i><br>
                            Ki·ªÉm tra gi·ªØa k·ª≥<br>
                            <small>90 ph√∫t</small>
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button type="button" class="btn btn-outline-success w-100 mb-2" onclick="setQuickTemplate('final')">
                            <i class="fas fa-graduation-cap"></i><br>
                            Thi cu·ªëi k·ª≥<br>
                            <small>120 ph√∫t</small>
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button type="button" class="btn btn-outline-info w-100 mb-2" onclick="setQuickTemplate('quiz')">
                            <i class="fas fa-question"></i><br>
                            Ki·ªÉm tra nhanh<br>
                            <small>45 ph√∫t</small>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startTimeInput = document.querySelector('input[name="StartTime"]');
            const endTimeInput = document.querySelector('input[name="EndTime"]');
            const durationInput = document.querySelector('#duration');
            
            function calculateDuration() {
                if (startTimeInput.value && endTimeInput.value) {
                    const start = new Date(startTimeInput.value);
                    const end = new Date(endTimeInput.value);
                    const diffMinutes = (end - start) / (1000 * 60);
                    
                    if (diffMinutes > 0) {
                        durationInput.value = diffMinutes;
                    } else {
                        durationInput.value = '';
                    }
                }
            }
            
            startTimeInput.addEventListener('change', calculateDuration);
            endTimeInput.addEventListener('change', calculateDuration);
        });
        
        function setQuickTemplate(type) {
            const now = new Date();
            const startTime = new Date(now.getTime() + 24 * 60 * 60 * 1000); // Tomorrow
            startTime.setHours(8, 0, 0, 0); // 8:00 AM
            
            let duration = 90; // Default 90 minutes
            let instructions = '';
            
            switch(type) {
                case 'midterm':
                    duration = 90;
                    instructions = 'Ki·ªÉm tra gi·ªØa k·ª≥. H·ªçc sinh c·∫ßn mang theo b√∫t, gi·∫•y nh√°p. Kh√¥ng ƒë∆∞·ª£c s·ª≠ d·ª•ng t√†i li·ªáu.';
                    break;
                case 'final':
                    duration = 120;
                    instructions = 'Thi cu·ªëi k·ª≥. H·ªçc sinh c·∫ßn mang theo th·∫ª sinh vi√™n, b√∫t vi·∫øt. ƒê∆∞·ª£c ph√©p s·ª≠ d·ª•ng m√°y t√≠nh c·∫ßm tay.';
                    break;
                case 'quiz':
                    duration = 45;
                    instructions = 'Ki·ªÉm tra nhanh. Th·ªùi gian ng·∫Øn, t·∫≠p trung v√†o ki·∫øn th·ª©c c∆° b·∫£n.';
                    break;
            }
            
            const endTime = new Date(startTime.getTime() + duration * 60 * 1000);
            
            document.querySelector('input[name="StartTime"]').value = startTime.toISOString().slice(0, 16);
            document.querySelector('input[name="EndTime"]').value = endTime.toISOString().slice(0, 16);
            document.querySelector('textarea[name="Instructions"]').value = instructions;
            document.querySelector('#duration').value = duration;
        }
    </script>
}
</div> <!-- End teacher-page-container -->
