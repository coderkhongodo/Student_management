@model IEnumerable<StudentManagementSystem.Models.ExamSchedule>
@{
    ViewData["Title"] = "B√†i thi c√≥ s·∫µn";
}

@section Styles {
    <link href="~/css/admin-ui.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet" />
}

<!-- Welcome Header with Animation -->
<div class="welcome-header mb-4">
    <div class="d-flex justify-content-between align-items-center">
        <div class="position-relative z-index-2">
            <h2 class="mb-2 animate__animated animate__fadeInLeft fw-bold">
                <i class="fas fa-file-alt me-2"></i>
                B√†i thi c√≥ s·∫µn üìù
            </h2>
            <p class="mb-0 opacity-75">Danh s√°ch c√°c b√†i thi b·∫°n c√≥ th·ªÉ tham gia</p>
        </div>
        <div class="text-end position-relative z-index-2">
            <a href="@Url.Action("Index")" class="btn btn-light btn-lg px-4 py-2 rounded-pill shadow-sm">
                <i class="fas fa-arrow-left me-2"></i>Quay l·∫°i Dashboard
            </a>
        </div>
    </div>
</div>

<div class="admin-action-card animate__animated animate__fadeInUp">
    <div class="card-header">
        <h5 class="mb-0 fw-bold">
            <i class="fas fa-list me-2"></i> Danh s√°ch b√†i thi
        </h5>
    </div>
    <div class="card-body">
        @if (Model.Any())
        {
            <div class="row g-4">
                @foreach (var examSchedule in Model)
                {
                    var now = DateTime.Now;
                    var isAvailable = now >= examSchedule.StartTime && now <= examSchedule.EndTime && examSchedule.IsActive;
                    var hasStarted = now >= examSchedule.StartTime;
                    var hasEnded = now > examSchedule.EndTime;
                    var hasSubmitted = examSchedule.Submissions.Any();
                    
                    <div class="col-md-6 col-lg-4">
                        <div class="exam-card animate__animated animate__fadeIn" style="animation-delay: @(Model.ToList().IndexOf(examSchedule) * 0.1)s;">
                            @{
                                var statusClass = hasSubmitted ? "submitted" : isAvailable ? "available" : hasEnded ? "ended" : "upcoming";
                                var statusText = hasSubmitted ? "ƒê√£ n·ªôp" : isAvailable ? "C√≥ th·ªÉ thi" : hasEnded ? "ƒê√£ k·∫øt th√∫c" : "S·∫Øp di·ªÖn ra";
                                var statusIcon = hasSubmitted ? "fas fa-check-circle" : isAvailable ? "fas fa-play-circle" : hasEnded ? "fas fa-times-circle" : "fas fa-clock";
                                var gradientClass = hasSubmitted ? "linear-gradient(135deg, #28a745, #20c997)" : 
                                                   isAvailable ? "linear-gradient(135deg, #007bff, #6610f2)" : 
                                                   hasEnded ? "linear-gradient(135deg, #6c757d, #495057)" : 
                                                   "linear-gradient(135deg, #ffc107, #fd7e14)";
                            }
                            
                            <div class="exam-card-header" style="background: @gradientClass;">
                                <div class="exam-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="exam-info">
                                    <h5 class="exam-title">@examSchedule.Exam.Title</h5>
                                    <div class="exam-status">
                                        <i class="@statusIcon me-1"></i>@statusText
                                    </div>
                                </div>
                            </div>
                            
                            <div class="exam-card-body">
                                <div class="class-info mb-3">
                                    <h6 class="section-title">L·ªõp h·ªçc</h6>
                                    <span class="class-badge">
                                        <i class="fas fa-users me-1"></i>@examSchedule.ClassName
                                    </span>
                                </div>
                                
                                @if (!string.IsNullOrEmpty(examSchedule.Exam.Description))
                                {
                                    <div class="description-section mb-3">
                                        <h6 class="section-title">M√¥ t·∫£</h6>
                                        <p class="description-text">@examSchedule.Exam.Description</p>
                                    </div>
                                }
                                
                                <div class="exam-details mb-3">
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <div class="detail-item">
                                                <div class="detail-value text-primary">@examSchedule.StartTime.ToString("dd/MM/yyyy")</div>
                                                <div class="detail-label">Ng√†y thi</div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="detail-item">
                                                <div class="detail-value text-info">@examSchedule.DurationMinutes ph√∫t</div>
                                                <div class="detail-label">Th·ªùi l∆∞·ª£ng</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="time-info mb-3">
                                    <h6 class="section-title">Th·ªùi gian thi</h6>
                                    <div class="time-display">
                                        <i class="fas fa-clock me-1"></i>
                                        @examSchedule.StartTime.ToString("HH:mm") - @examSchedule.EndTime.ToString("HH:mm")
                                    </div>
                                </div>
                                
                                @if (!string.IsNullOrEmpty(examSchedule.Location))
                                {
                                    <div class="location-info mb-3">
                                        <h6 class="section-title">ƒê·ªãa ƒëi·ªÉm</h6>
                                        <div class="location-display">
                                            <i class="fas fa-map-marker-alt me-1 text-danger"></i>
                                            <span>@examSchedule.Location</span>
                                        </div>
                                    </div>
                                }
                                
                                @if (!string.IsNullOrEmpty(examSchedule.Instructions))
                                {
                                    <div class="instructions-section mb-3">
                                        <h6 class="section-title">H∆∞·ªõng d·∫´n</h6>
                                        <p class="instructions-text">@examSchedule.Instructions</p>
                                    </div>
                                }
                            </div>
                            
                            <div class="exam-card-footer">
                                @if (hasSubmitted)
                                {
                                    <div class="status-display submitted">
                                        <i class="fas fa-check-circle me-2"></i>
                                        <span>B·∫°n ƒë√£ n·ªôp b√†i thi n√†y</span>
                                    </div>
                                    <a href="@Url.Action("MySubmissions")" class="action-btn view-btn">
                                        <i class="fas fa-eye me-1"></i>Xem b√†i ƒë√£ n·ªôp
                                    </a>
                                }
                                else if (isAvailable)
                                {
                                    <div class="status-display available">
                                        <i class="fas fa-play-circle me-2"></i>
                                        <span>B√†i thi ƒëang di·ªÖn ra</span>
                                    </div>
                                    <a href="@Url.Action("TakeExam", new { id = examSchedule.Id })" class="action-btn take-exam-btn">
                                        <i class="fas fa-play me-1"></i>B·∫Øt ƒë·∫ßu thi
                                    </a>
                                }
                                else if (!hasStarted)
                                {
                                    <div class="status-display upcoming">
                                        <i class="fas fa-clock me-2"></i>
                                        <span>B√†i thi ch∆∞a b·∫Øt ƒë·∫ßu</span>
                                    </div>
                                    <div class="countdown-timer" data-start-time="@examSchedule.StartTime.ToString("yyyy-MM-ddTHH:mm:ss")">
                                        <span class="countdown-text">B·∫Øt ƒë·∫ßu sau: </span>
                                        <span class="countdown-value">--:--:--</span>
                                    </div>
                                }
                                else if (hasEnded)
                                {
                                    <div class="status-display ended">
                                        <i class="fas fa-times-circle me-2"></i>
                                        <span>B√†i thi ƒë√£ k·∫øt th√∫c</span>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="text-center py-5">
                <div class="empty-state">
                    <div class="empty-state-icon mb-4">
                        <i class="fas fa-file-alt fa-4x" style="color: #a8e6cf;"></i>
                    </div>
                    <h4 class="text-muted mb-3">Hi·ªán t·∫°i kh√¥ng c√≥ b√†i thi n√†o</h4>
                    <p class="text-muted mb-4">H√£y ki·ªÉm tra l·∫°i sau ho·∫∑c li√™n h·ªá v·ªõi gi·∫£ng vi√™n ƒë·ªÉ bi·∫øt th√™m th√¥ng tin.</p>
                    <a href="@Url.Action("Index")" class="btn btn-primary-gradient btn-lg rounded-pill px-4">
                        <i class="fas fa-home me-2"></i>V·ªÅ Dashboard
                    </a>
                </div>
            </div>
        }
    </div>
</div>
