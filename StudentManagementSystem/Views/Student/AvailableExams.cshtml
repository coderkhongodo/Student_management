@model IEnumerable<StudentManagementSystem.Models.ExamSchedule>
@{
    ViewData["Title"] = "B√†i thi c√≥ s·∫µn";
}

@section Styles {
    <link href="~/css/student-ui.css" rel="stylesheet" />
}

<div class="student-page-container">
    <!-- Welcome Header -->
    <div class="welcome-header mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <div class="position-relative z-index-2">
                <h2 class="mb-2 fw-bold">
                    <i class="fas fa-file-alt me-2"></i>
                    B√†i thi c√≥ s·∫µn üìù
                </h2>
                <p class="mb-0 opacity-75">Xem v√† tham gia c√°c b√†i ki·ªÉm tra ƒëang di·ªÖn ra</p>
            </div>
            <div class="text-end position-relative z-index-2">
                <a href="@Url.Action("Index")" class="btn btn-light btn-lg px-4 py-2 rounded-pill shadow-sm">
                    <i class="fas fa-arrow-left me-2"></i> Quay l·∫°i Dashboard
                </a>
            </div>
        </div>
    </div>

    <div class="admin-action-card">
        <div class="card-header">
            <h5 class="mb-0 fw-bold">
                <i class="fas fa-list me-2"></i> Danh s√°ch b√†i thi
            </h5>
        </div>
        <div class="card-body">
            @if (Model != null && Model.Any())
            {
                <div class="row g-4">
                    @foreach (var examSchedule in Model)
                    {
                        var now = DateTime.Now;
                        var isAvailable = now >= examSchedule.StartTime && now <= examSchedule.EndTime && examSchedule.IsActive;
                        var hasEnded = now > examSchedule.EndTime;
                        var hasSubmitted = examSchedule.Submissions?.Any() ?? false;

                        <div class="col-md-6 col-lg-4">
                            <div class="exam-card">
                                <div class="exam-card-header">
                                    <div class="exam-status">
                                        @if (hasSubmitted)
                                        {
                                            <i class="fas fa-check-circle text-success"></i>
                                            <span>ƒê√£ n·ªôp</span>
                                        }
                                        else if (isAvailable)
                                        {
                                            <i class="fas fa-play-circle text-primary"></i>
                                            <span>C√≥ th·ªÉ thi</span>
                                        }
                                        else if (hasEnded)
                                        {
                                            <i class="fas fa-times-circle text-danger"></i>
                                            <span>ƒê√£ k·∫øt th√∫c</span>
                                        }
                                        else
                                        {
                                            <i class="fas fa-clock text-warning"></i>
                                            <span>S·∫Øp di·ªÖn ra</span>
                                        }
                                    </div>
                                    <h5 class="exam-title">@examSchedule.Exam.Title</h5>
                                    <p class="exam-class">L·ªõp: @(examSchedule.Class?.ClassName ?? examSchedule.ClassName)</p>
                                </div>

                                <div class="exam-card-body">
                                    @if (!string.IsNullOrEmpty(examSchedule.Exam.Description))
                                    {
                                        <div class="exam-info-item">
                                            <span class="exam-info-label">M√¥ t·∫£:</span>
                                            <span class="exam-info-value">@examSchedule.Exam.Description</span>
                                        </div>
                                    }

                                    <div class="exam-info">
                                        <div class="exam-info-item">
                                            <span class="exam-info-label">Ng√†y thi:</span>
                                            <span class="exam-info-value">@examSchedule.StartTime.ToString("dd/MM/yyyy")</span>
                                        </div>
                                        <div class="exam-info-item">
                                            <span class="exam-info-label">Th·ªùi gian:</span>
                                            <span class="exam-info-value">@examSchedule.StartTime.ToString("HH:mm") - @examSchedule.EndTime.ToString("HH:mm")</span>
                                        </div>
                                        <div class="exam-info-item">
                                            <span class="exam-info-label">Th·ªùi l∆∞·ª£ng:</span>
                                            <span class="exam-info-value">@((examSchedule.EndTime - examSchedule.StartTime).TotalMinutes) ph√∫t</span>
                                        </div>
                                        @if (!string.IsNullOrEmpty(examSchedule.Location))
                                        {
                                            <div class="exam-info-item">
                                                <span class="exam-info-label">ƒê·ªãa ƒëi·ªÉm:</span>
                                                <span class="exam-info-value">@examSchedule.Location</span>
                                            </div>
                                        }
                                    </div>

                                    <div class="exam-actions mt-3">
                                        @if (isAvailable && !hasSubmitted)
                                        {
                                            <a href="@Url.Action("TakeExam", new { id = examSchedule.Id })" class="btn btn-primary btn-sm w-100">
                                                <i class="fas fa-play"></i> B·∫Øt ƒë·∫ßu thi
                                            </a>
                                        }
                                        else if (hasSubmitted)
                                        {
                                            <button class="btn btn-success btn-sm w-100" disabled>
                                                <i class="fas fa-check"></i> ƒê√£ n·ªôp b√†i
                                            </button>
                                        }
                                        else if (hasEnded)
                                        {
                                            <button class="btn btn-secondary btn-sm w-100" disabled>
                                                <i class="fas fa-times"></i> ƒê√£ h·∫øt h·∫°n
                                            </button>
                                        }
                                        else
                                        {
                                            <button class="btn btn-warning btn-sm w-100" disabled>
                                                <i class="fas fa-clock"></i> Ch∆∞a ƒë·∫øn gi·ªù
                                            </button>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="text-center py-5">
                    <i class="fas fa-file-alt fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">Hi·ªán t·∫°i kh√¥ng c√≥ b√†i thi n√†o</h5>
                    <p class="text-muted">H√£y ki·ªÉm tra l·∫°i sau ho·∫∑c li√™n h·ªá v·ªõi gi·∫£ng vi√™n ƒë·ªÉ bi·∫øt th√™m th√¥ng tin.</p>
                    <a href="@Url.Action("Index")" class="btn btn-primary">
                        <i class="fas fa-home"></i> V·ªÅ Dashboard
                    </a>
                </div>
            }
        </div>
    </div>
</div>
